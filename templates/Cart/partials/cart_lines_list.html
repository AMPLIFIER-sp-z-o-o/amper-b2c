{% load i18n %}

<div
  id="{{ container_id|default:'cart-page-lines' }}"
  class="min-w-0 flex-1 space-y-4"
  {% if show_stock_validation %}data-checkout-stock-validation{% endif %}
>
  {% if lines %}
    {% for line in lines %}
      <div
        data-cart-line
        data-cart-line-id="{{ line.id }}"
        data-product-url="{{ line.product.get_absolute_url }}"
        class="relative flex items-start gap-4 overflow-hidden rounded-xl bg-white p-4 shadow-[0_2px_8px_rgba(0,0,0,0.08)] transition-shadow duration-300 hover:shadow-[0_8px_24px_rgba(0,0,0,0.12)] dark:bg-gray-800 cursor-pointer sm:gap-5"
      >
        <a
          href="{{ line.product.get_absolute_url }}"
          class="absolute inset-0 z-0"
          aria-label="{% blocktranslate with name=line.product.name %}View {{ name }}{% endblocktranslate %}"
        ></a>

        <div class="relative z-10 w-16 h-16 shrink-0 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden pointer-events-none">
          {% with line.product.images.all|first as img %}
            {% if img %}
              <img class="h-full w-full object-cover" src="{{ img.image.url }}" alt="{{ line.product.name }}">
            {% else %}
              <div class="h-full w-full bg-gray-200 dark:bg-gray-700"></div>
            {% endif %}
          {% endwith %}
        </div>

        <div class="relative z-10 min-w-0 flex-1 space-y-3 pointer-events-none">
          <a
            href="{{ line.product.get_absolute_url }}"
            class="pointer-events-auto relative z-10 block text-base font-bold text-gray-900 dark:text-white line-clamp-2 wrap-break-word hover:underline"
            title="{{ line.product.name }}"
          >
            {{ line.product.name }}
          </a>

          <p
            data-cart-unit-price-row
            class="text-subtitle{% if line.quantity|default:0|add:0 <= 1 %} hidden{% endif %}"
          >
            {% translate "Per item" %}:
            <span data-cart-unit-price data-price="{{ line.price }}" data-currency="{{ site_currency }}">{{ line.price }}</span>
          </p>

          <div class="flex items-center justify-between gap-4">
            <div class="flex items-center gap-4">
              <div
                data-qty-wrap
                class="pointer-events-auto inline-flex items-center bg-white dark:bg-gray-700 rounded-full shadow-sm ring-1 ring-gray-200 dark:ring-gray-600 transition-all focus-within:shadow-[0_4px_8px_0_rgba(0,0,0,0.16),0_0_2px_1px_rgba(0,0,0,0.08)] dark:focus-within:shadow-[0_4px_8px_0_rgba(0,0,0/0.5),0_0_2px_1px_rgba(0,0,0/0.3)]{% if show_stock_validation and line.checkout_stock_issue %} ring-red-500 dark:ring-red-500{% endif %}"
              >
                {% include "Cart/cart_line_input.html" with quantity=line.quantity product_id=line.product.id size='lg' max_quantity=line.product.stock %}
              </div>

              <div class="flex items-center gap-1">
                <button
                  type="button"
                  class="pointer-events-auto favorite-btn inline-flex h-11 w-11 items-center justify-center rounded-full hover-bg btn-press cursor-pointer"
                  data-product-id="{{ line.product.id }}"
                  aria-label="{% blocktranslate with name=line.product.name %}Add {{ name }} to favorites{% endblocktranslate %}"
                  title="{% translate 'Add to Favorites' %}"
                >
                  <svg class="favorite-icon h-5 w-5 text-gray-500 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                  </svg>
                  <svg class="favorite-icon-filled h-5 w-5 text-rose-500 hidden" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                  </svg>
                </button>

                <button
                  data-product-id="{{ line.product.id }}"
                  type="button"
                  class="pointer-events-auto remove-cart-line inline-flex h-11 w-11 items-center justify-center rounded-full text-gray-700 hover-bg btn-press dark:text-gray-200 cursor-pointer"
                  aria-label="{% blocktranslate with name=line.product.name %}Remove {{ name }} from cart{% endblocktranslate %}"
                  title="{% translate 'Remove' %}"
                >
                  <svg class="h-5 w-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 7h14m-9 3v8m4-8v8M10 3h4a1 1 0 0 1 1 1v3H9V4a1 1 0 0 1 1-1zM6 7h12v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7z" />
                  </svg>
                </button>
              </div>
            </div>

            <p data-cart-line-subtotal data-price="{{ line.subtotal }}" data-currency="{{ site_currency }}" class="w-24 shrink-0 text-end text-base font-semibold text-gray-900 dark:text-white sm:hidden">
              {{ line.subtotal|floatformat:2 }}
            </p>
          </div>

          {% if show_stock_validation and line.checkout_stock_issue %}
            <div data-stock-issue="1" data-stock-issue-available="{{ line.checkout_stock_available }}" class="pointer-events-none rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-800 dark:border-red-900/40 dark:bg-red-900/20 dark:text-red-200">
              {% if line.checkout_stock_available > 0 %}
                <p class="font-semibold">
                  {% blocktranslate with available=line.checkout_stock_available %}Only {{ available }} items are available for this product.{% endblocktranslate %}
                </p>
                <p class="mt-1">{% translate "Change the quantity to continue checkout." %}</p>
                <button
                  type="button"
                  data-product-id="{{ line.product.id }}"
                  data-quantity="{{ line.checkout_stock_available }}"
                  data-add-to-cart-mode="set"
                  class="pointer-events-auto add-to-cart-btn mt-3 inline-flex items-center justify-center rounded-lg bg-white px-4 py-2 text-sm font-semibold text-gray-900 hover:bg-gray-100 focus:outline-none focus:ring-4 focus:ring-gray-100 dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 dark:focus:ring-gray-700 cursor-pointer"
                >
                  {% blocktranslate with available=line.checkout_stock_available %}Set {{ available }} items{% endblocktranslate %}
                </button>
              {% else %}
                <p class="font-semibold">{% translate "This product is currently unavailable." %}</p>
                <p class="mt-1">{% translate "Remove it from your cart to continue checkout." %}</p>
              {% endif %}
            </div>
          {% endif %}
        </div>

        <p data-cart-line-subtotal data-price="{{ line.subtotal }}" data-currency="{{ site_currency }}" class="relative z-10 hidden w-24 shrink-0 text-end text-base font-semibold text-gray-900 dark:text-white sm:block pointer-events-none">
          {{ line.subtotal|floatformat:2 }}
        </p>
      </div>
    {% endfor %}
  {% endif %}
  <div
    data-cart-page-empty-state
    class="rounded-xl bg-white dark:bg-gray-800 shadow-[0_2px_8px_rgba(0,0,0,0.08)] p-6 sm:p-8{% if lines %} hidden{% endif %}"
  >
    <div class="flex min-h-44 flex-col items-center justify-center text-center">
      <p class="text-base font-semibold text-gray-700 dark:text-gray-200">{% translate "Your cart is empty" %}</p>
      <p class="mt-1 text-subtitle">{% translate "Continue shopping and add items to start checkout." %}</p>
      <a
        href="/"
        class="mt-4 inline-flex items-center justify-center rounded-lg bg-primary-700 px-5 py-2.5 text-sm font-medium text-white transition-colors duration-200 hover:bg-primary-800 focus:outline-none focus:ring-4 focus:ring-primary-300 dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800"
      >
        {% translate "Continue shopping" %}
      </a>
    </div>
  </div>
</div>
