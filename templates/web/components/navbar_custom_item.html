{% load i18n %}
{# Custom navbar item with category dropdown support #}
{# Variables: item (NavbarItem), loop_index #}

{% if item.item_type == 'separator' %}
<div class="shrink-0 px-1 flex items-center">
  <span class="w-px h-6 bg-gray-300 dark:bg-gray-600"></span>
</div>
{% elif item.item_type == 'custom_link' %}
<div class="shrink-0 nav-priority-item px-1 flex items-center nav-category-trigger">
  <a 
    href="{{ item.url }}"
    {% if item.open_in_new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
    class="nav-category-btn inline-flex items-center gap-1.5 text-sm font-medium cursor-pointer whitespace-nowrap px-3 py-2.5 rounded-lg border border-transparent transition-colors duration-200 {% if item.label_color %}{% else %}text-gray-900 dark:text-white{% endif %}"
    {% if item.label_color %}style="color: {{ item.label_color }};"{% endif %}
  >
    {% if item.icon %}
    <span class="text-base">{{ item.icon }}</span>
    {% endif %}
    <span>{{ item.label }}</span>
  </a>
</div>
{% elif item.item_type == 'category' and item.category %}
{# Category item with optional dropdown #}
<div class="shrink-0 nav-category-trigger nav-priority-item px-1 flex items-center {% if item.has_children %}has-children{% endif %}" 
     data-category-id="{{ item.category.id }}" 
     data-dropdown-target="categoryDropdown{{ item.category.id }}">
  <a href="{{ item.category.get_absolute_url }}" class="nav-category-btn inline-flex items-center gap-1 text-sm font-medium cursor-pointer whitespace-nowrap px-3 py-2.5 rounded-lg border border-transparent transition-colors duration-200 {% if item.label_color %}{% else %}text-gray-900 dark:text-white{% endif %}"
    {% if item.label_color %}style="color: {{ item.label_color }};"{% endif %}>
    {% if item.icon %}
    <span class="text-base">{{ item.icon }}</span>
    {% endif %}
    <span>{{ item.get_display_label }}</span>
    {% if item.has_children %}
    <svg class="nav-dropdown-arrow w-4 h-4 transition-transform duration-300" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"></path>
    </svg>
    {% endif %}
  </a>
  
  {# Category dropdown - reusing the same structure as default navbar #}
  {% if item.has_children %}
  <div id="categoryDropdown{{ item.category.id }}" class="category-dropdown transition-opacity duration-300 hidden absolute left-0 w-162.5 bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 z-50 before:absolute before:-top-10 before:h-10 before:w-full before:content-['']">
    <div class="flex h-full min-h-95 overflow-hidden rounded-lg">
      <!-- Left Column: Categories -->
      <div class="w-1/2 border-r border-gray-100 dark:border-gray-700 p-3 flex flex-col bg-white dark:bg-gray-800">
        <div class="mb-2 px-2">
          <a href="{{ item.category.get_absolute_url }}" class="subcategory-item flex items-center gap-2 px-3 py-2 text-sm font-extrabold text-gray-900 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors duration-200"
              data-preview-title="{{ item.category.name }}"
              data-preview-url="{{ item.category.get_absolute_url }}" 
              data-has-children="false"
              data-parent-id="{{ item.category.id }}">
            {% translate "All" %} {{ item.category.name }}
          </a>
        </div>
        <ul class="flex-1 overflow-y-auto max-h-100 cursor-pointer space-y-0.5 p-1 custom-scrollbar">
          {% for child in item.category.children.all %}
          <li class="subcategory-item group cursor-pointer" 
              data-preview-title="{{ child.name }}"
              data-preview-url="{{ child.get_absolute_url }}" 
              data-has-children="{% if child.children.all %}true{% else %}false{% endif %}"
              data-parent-id="{{ item.category.id }}">
            <a href="{{ child.get_absolute_url }}" class="flex items-center justify-between px-3 py-2 text-sm text-gray-700 dark:text-gray-300 group-hover:bg-gray-200 dark:group-hover:bg-gray-700 rounded-lg transition-colors duration-200">
              <span class="font-medium">{{ child.name }}</span>
              {% if child.children.all %}
              <svg class="w-4 h-4 text-gray-400 group-hover:text-primary-500 transition-colors duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
              {% endif %}
            </a>
            
            {% if child.children.all %}
            <div class="hidden sub-children-data">
              {% include "web/components/category_mega_tree.html" with items=child.children.all indent=1 %}
            </div>
            {% endif %}
          </li>
          {% endfor %}
        </ul>
      </div>
      
      <!-- Right Column: Preview/Action Area -->
      <div class="w-1/2 bg-gray-50/80 dark:bg-gray-900/40 p-3 flex flex-col relative overflow-hidden">
        <!-- Decorative background element -->
        <div class="absolute -right-8 -bottom-8 w-32 h-32 bg-primary-500/5 rounded-full blur-2xl"></div>
        <div class="absolute -left-8 -top-8 w-32 h-32 bg-primary-500/5 rounded-full blur-2xl"></div>
        
        <div id="previewPane{{ item.category.id }}" 
             data-main-name="{{ item.category.name }}"
             data-main-url="{{ item.category.get_absolute_url }}"
             class="w-full flex-1 z-10 flex flex-col">
          <!-- Default State -->
          <div class="preview-content flex flex-col items-center justify-center h-full w-full animate-fade-in p-6 text-center">
               <div class="w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4 text-gray-400">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
               </div>
               <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">{{ item.category.name }}</h3>
               <a href="{{ item.category.get_absolute_url }}" class="inline-flex items-center justify-center w-auto px-6 py-2.5 bg-primary-700 text-white hover:bg-primary-800 text-sm font-bold rounded-lg transition-colors duration-300 shadow-sm">
                  {% translate "Go to" %} {{ item.category.name }}
               </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endif %}
