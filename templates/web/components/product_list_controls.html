{% load i18n %}
{# Product list controls - sorting, view toggle, pagination info #}
{# Usage: {% include "web/components/product_list_controls.html" with position="top" %} #}

{# Mobile Controls Bar - Only at top #}
{% if position != 'bottom' %}
<div id="mobile-sticky-controls" class="lg:hidden sticky z-30 flex items-center border-b border-gray-200 dark:border-gray-700 mb-4 bg-white dark:bg-gray-900 transition-all duration-200">
  {# View Toggle - Mobile #}
  <button type="button"
     data-view-toggle="grid"
     onclick="toggleViewMode('list')"
    class="{% if view_mode != 'grid' %}hidden{% endif %} flex items-center justify-center p-3 border-r border-gray-200 dark:border-gray-700 text-gray-700 hover:bg-gray-200 hover:text-primary-600 dark:text-gray-200 dark:hover:bg-gray-700 dark:hover:text-primary-400 transition-colors cursor-pointer"
     aria-label="{% translate 'Switch to list view' %}">
    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M9 8h10M9 12h10M9 16h10M4.99 8H5m-.02 4h.01m0 4H5"/>
    </svg>
  </button>
  <button type="button"
     data-view-toggle="list"
     onclick="toggleViewMode('grid')"
    class="{% if view_mode == 'grid' %}hidden{% endif %} flex items-center justify-center p-3 border-r border-gray-200 dark:border-gray-700 text-gray-700 hover:bg-gray-200 hover:text-primary-600 dark:text-gray-200 dark:hover:bg-gray-700 dark:hover:text-primary-400 transition-colors cursor-pointer"
     aria-label="{% translate 'Switch to grid view' %}">
    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.143 4H4.857A.857.857 0 0 0 4 4.857v4.286c0 .473.384.857.857.857h4.286A.857.857 0 0 0 10 9.143V4.857A.857.857 0 0 0 9.143 4Zm10 0h-4.286a.857.857 0 0 0-.857.857v4.286c0 .473.384.857.857.857h4.286A.857.857 0 0 0 20 9.143V4.857A.857.857 0 0 0 19.143 4Zm-10 10H4.857a.857.857 0 0 0-.857.857v4.286c0 .473.384.857.857.857h4.286a.857.857 0 0 0 .857-.857v-4.286A.857.857 0 0 0 9.143 14Zm10 0h-4.286a.857.857 0 0 0-.857.857v4.286c0 .473.384.857.857.857h4.286a.857.857 0 0 0 .857-.857v-4.286a.857.857 0 0 0-.857-.857Z"/>
    </svg>
  </button>
  
  {# Categories and Filters Button #}
  <button
    data-drawer-target="drawer-mobile-filter"
    data-drawer-show="drawer-mobile-filter"
    data-drawer-placement="right"
    aria-controls="drawer-mobile-filter"
    type="button"
    class="flex-1 flex items-center justify-center gap-2 p-3 border-r border-gray-200 dark:border-gray-700 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors cursor-pointer"
  >
    <span>{% translate "Categories and filters" %}</span>
  </button>
  
  {# Sorting Button #}
  <button
    data-drawer-target="drawer-mobile-sorting"
    data-drawer-show="drawer-mobile-sorting"
    data-drawer-placement="right"
    aria-controls="drawer-mobile-sorting"
    type="button"
    class="flex-1 flex flex-col items-center justify-center p-3 text-sm hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors cursor-pointer"
  >
    <span class="text-gray-700 dark:text-gray-300 font-medium">{% translate "Sorting" %}</span>
    <span class="text-xs text-gray-500 dark:text-gray-400">
      {% if current_sort == 'price_asc' %}{% translate "Price: Low to High" %}{% elif current_sort == 'price_desc' %}{% translate "Price: High to Low" %}{% else %}{% translate "Most relevant" %}{% endif %}
    </span>
  </button>
</div>
{% endif %}

{# Desktop Controls #}
<div id="product-controls-{{ position|default:'top' }}" class="product-list-controls {% if position != 'bottom' %}hidden lg:flex{% else %}flex{% endif %} flex-col sm:flex-row items-center justify-between gap-4 py-4 {% if position == 'bottom' %}border-t border-gray-200 dark:border-gray-700 mt-8{% else %}border-b border-gray-200 dark:border-gray-700 mb-6{% endif %}">
  
  <div class="flex items-center gap-4 lg:gap-6 w-full sm:w-auto">
    {% if position != 'bottom' %}
      {# View Toggle - Only at top #}
      {% include "web/components/view_toggle.html" with toggle_id=position|default:'top' toggle_function='toggleViewMode' current_view=view_mode %}
    {% endif %}

    {# Sort Dropdown - Common for top and bottom #}
    <div class="relative w-full max-w-60 sm:w-60">
      <label class="absolute -top-2 left-3 bg-white px-1 text-xs font-medium text-gray-500 dark:bg-gray-800 dark:text-gray-400 z-10">{% translate "Sorting" %}</label>
            <button id="sortDropdownButton{{ position|default:'top'|title }}" 
              data-sort-dropdown-trigger="dropdownSort{{ position|default:'top'|title }}"
              type="button" 
              aria-haspopup="true"
              aria-expanded="false"
              class="inline-flex w-full items-center justify-between rounded-md border-none bg-white px-4 py-2.5 text-sm font-medium text-gray-900 shadow-[0_2px_8px_rgba(0,0,0,0.08)] transition-shadow duration-300 hover:shadow-[0_8px_24px_rgba(0,0,0,0.12)] focus:outline-none focus:shadow-[0_4px_8px_0_rgba(0,0,0,0.16),0_0_2px_1px_rgba(0,0,0,0.08)] dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600 dark:focus:bg-gray-600 dark:focus:shadow-[0_4px_10px_-2px_rgb(0_0_0/0.5)] cursor-pointer">
        <span class="truncate">
          {% for key, field, label in sort_options %}
            {% if current_sort == key %}{{ label }}{% endif %}
          {% endfor %}
        </span>
        <svg class="ml-2 h-4 w-4 shrink-0" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"/>
        </svg>
      </button>
      <div id="dropdownSort{{ position|default:'top'|title }}" data-sort-dropdown-menu class="absolute left-0 top-full mt-1 z-50 hidden w-full divide-y divide-gray-100 rounded-lg bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 opacity-0 pointer-events-none transition-opacity duration-150 ease-out">
        <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="sortDropdownButton{{ position|default:'top'|title }}">
          {% for key, field, label in sort_options %}
          <li>
            {% with query_string=query_string_without_sort %}
            <a href="{% if query_string or key != 'relevance' %}?{% if query_string %}{{ query_string }}{% endif %}{% if key != 'relevance' %}{% if query_string %}&{% endif %}sort={{ key }}{% endif %}{% else %}{{ request.path }}{% endif %}" 
              data-pagination-link
              data-sort-link
              hx-get="{% if query_string or key != 'relevance' %}?{% if query_string %}{{ query_string }}{% endif %}{% if key != 'relevance' %}{% if query_string %}&{% endif %}sort={{ key }}{% endif %}{% else %}{{ request.path }}{% endif %}"
              hx-target="#products-container"
              hx-swap="innerHTML"
              hx-push-url="true"
              class="flex items-center justify-between px-4 py-2.5 hover:bg-gray-200 dark:hover:bg-gray-700 {% if current_sort == key %}bg-gray-100 dark:bg-gray-600 font-bold text-primary-600 dark:text-primary-400{% endif %}">
              <span>{{ label }}</span>
              {% if current_sort == key %}
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 8.207-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 0 1 1.414-1.414L9 10.586l3.293-3.293a1 1 0 0 1 1.414 1.414Z"/>
              </svg>
              {% endif %}
            </a>
            {% endwith %}
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>

    {# Item range info - Common for top and bottom #}
    <span class="hidden md:inline-block text-sm text-gray-500 dark:text-gray-400 whitespace-nowrap">
      {{ start_index }}-{{ end_index }} {% translate "of" %} {{ total_count }}
    </span>
  </div>

  {# Full Pagination - Same for both #}
  <nav class="flex items-center gap-1.5 w-full sm:w-auto justify-center sm:justify-end" aria-label="{% translate 'Pagination' %}">
    {# Previous button #}
    {% if products.has_previous %}
     {% with prev_page=products.previous_page_number %}
     <a href="{% if prev_page == 1 %}{% if query_string %}?{{ query_string }}{% else %}{{ request.path }}{% endif %}{% else %}?{% if query_string %}{{ query_string }}&{% endif %}page={{ prev_page }}{% endif %}" 
       data-pagination-link
       hx-get="{% if prev_page == 1 %}{% if query_string %}?{{ query_string }}{% else %}{{ request.path }}{% endif %}{% else %}?{% if query_string %}{{ query_string }}&{% endif %}page={{ prev_page }}{% endif %}"
       hx-target="#products-container"
       hx-swap="innerHTML"
       hx-push-url="true"
      class="pagination-link flex h-9 w-9 items-center justify-center rounded-md border-none bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 transition-all"
       aria-label="{% translate 'Previous page' %}">
      <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="m15 19-7-7 7-7"/>
      </svg>
    </a>
    {% endwith %}
    {% else %}
    <span class="flex h-9 w-9 items-center justify-center rounded-md border-none bg-gray-100 text-gray-300 cursor-not-allowed dark:bg-gray-800 dark:text-gray-600">
      <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="m15 19-7-7 7-7"/>
      </svg>
    </span>
    {% endif %}

    {# Page numbers #}
    {% for page_num in products.paginator.page_range %}
      {% if page_num == products.number %}
      <span class="flex h-9 min-w-9 items-center justify-center rounded-md border-none bg-white px-3 text-sm font-bold text-gray-900 dark:bg-gray-600 dark:text-white shadow-[0_4px_8px_0_rgba(0,0,0,0.16),0_0_2px_1px_rgba(0,0,0,0.08)]">
        {{ page_num }}
      </span>
      {% elif page_num == 1 or page_num == products.paginator.num_pages or page_num >= products.number|add:'-1' and page_num <= products.number|add:'1' %}
      <a href="{% if page_num == 1 %}{% if query_string %}?{{ query_string }}{% else %}{{ request.path }}{% endif %}{% else %}?{% if query_string %}{{ query_string }}&{% endif %}page={{ page_num }}{% endif %}" 
        data-pagination-link
        hx-get="{% if page_num == 1 %}{% if query_string %}?{{ query_string }}{% else %}{{ request.path }}{% endif %}{% else %}?{% if query_string %}{{ query_string }}&{% endif %}page={{ page_num }}{% endif %}"
        hx-target="#products-container"
        hx-swap="innerHTML"
        hx-push-url="true"
        class="pagination-link flex h-9 min-w-9 items-center justify-center rounded-md border-none bg-gray-100 px-3 text-sm font-medium text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-all">
        {{ page_num }}
      </a>
      {% elif page_num == products.number|add:'-2' or page_num == products.number|add:'2' %}
      <span class="flex h-9 items-center justify-center px-1 text-sm text-gray-400 dark:text-gray-500">...</span>
      {% endif %}
    {% endfor %}

    {# Next button #}
    {% if products.has_next %}
     <a href="?{% if query_string %}{{ query_string }}&{% endif %}page={{ products.next_page_number }}" 
       data-pagination-link
       hx-get="?{% if query_string %}{{ query_string }}&{% endif %}page={{ products.next_page_number }}"
       hx-target="#products-container"
       hx-swap="innerHTML"
       hx-push-url="true"
      class="pagination-link flex h-9 w-9 items-center justify-center rounded-md border-none bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 transition-all"
       aria-label="{% translate 'Next page' %}">
      <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="m9 5 7 7-7 7"/>
      </svg>
    </a>
    {% else %}
    <span class="flex h-9 w-9 items-center justify-center rounded-md border-none bg-gray-100 text-gray-300 cursor-not-allowed dark:bg-gray-800 dark:text-gray-600">
      <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="m9 5 7 7-7 7"/>
      </svg>
    </span>
    {% endif %}
  </nav>
</div>


