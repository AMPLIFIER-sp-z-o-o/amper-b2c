{% load i18n %}
{% if recommended_products %}
<div id="category-recommended-products-{{ current_category.id }}" class="category-recommended-products category-recommended-products-{{ current_category.id }} storefront-category-recommended-products storefront-category-recommended-products-{{ current_category.id }} mb-4">
  <div id="category-recommended-products-header-{{ current_category.id }}" class="mb-4 flex items-center justify-between lg:min-h-14 lg:items-end">
    <h3 class="text-lg font-bold text-gray-900 dark:text-white sm:text-xl">
      {% translate "Recommended in category" %}
    </h3>

    {% if recommended_products|length >= 2 %}
    <div class="flex items-center gap-2">
      <button 
        id="category-recommended-prev-{{ current_category.id }}"
        type="button" 
        class="category-recommended-prev flex h-9 w-9 items-center justify-center cursor-pointer rounded-md bg-white/95 text-gray-800 shadow-md transition-all duration-200 hover:bg-gray-200 hover:shadow-lg active:scale-95 dark:bg-gray-800/95 dark:text-white dark:hover:bg-gray-700 dark:active:bg-gray-600 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/95 disabled:hover:shadow-md disabled:active:scale-100 dark:disabled:hover:bg-gray-800/95"
        data-category-id="{{ current_category.id }}"
        aria-label="{% translate 'Previous' %}"
      >
        <svg class="h-5 w-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
          <path d="m15 19-7-7 7-7" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" />
        </svg>
      </button>
      <button 
        id="category-recommended-next-{{ current_category.id }}"
        type="button" 
        class="category-recommended-next flex h-9 w-9 items-center justify-center cursor-pointer rounded-md bg-white/95 text-gray-800 shadow-md transition-all duration-200 hover:bg-gray-200 hover:shadow-lg active:scale-95 dark:bg-gray-800/95 dark:text-white dark:hover:bg-gray-700 dark:active:bg-gray-600 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/95 disabled:hover:shadow-md disabled:active:scale-100 dark:disabled:hover:bg-gray-800/95"
        data-category-id="{{ current_category.id }}"
        aria-label="{% translate 'Next' %}"
      >
        <svg class="h-5 w-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
          <path d="m9 5 7 7-7 7" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" />
        </svg>
      </button>
    </div>
    {% endif %}
  </div>

  {# Product Slider Container #}
  <div id="category-recommended-carousel-{{ current_category.id }}" class="category-recommended-carousel relative">
    <div 
      id="category-recommended-swiper-{{ current_category.id }}"
      class="swiper category-recommended-swiper"
      data-category-id="{{ current_category.id }}"
      data-product-count="{{ recommended_products|length }}"
    >
      <div class="swiper-wrapper">
        {% for item in recommended_products %}
        <div class="swiper-slide">
          {% include "web/components/homepage_product_card.html" with product=item.product %}
        </div>
        {% endfor %}
      </div>
    </div>

  </div>
</div>

<style>
/* Category Recommended Products - horizontal overflow only */
.category-recommended-products {
  position: relative;
  z-index: 1;
}

/* Keep navigation buttons hidden until Swiper finishes initialization
   and confirms there are navigable slides. */
.category-recommended-products .category-recommended-prev,
.category-recommended-products .category-recommended-next {
  opacity: 0;
  pointer-events: none;
}

.category-recommended-products.category-recommended-nav-ready .category-recommended-prev,
.category-recommended-products.category-recommended-nav-ready .category-recommended-next {
  opacity: 1;
  pointer-events: auto;
}

.category-recommended-products .category-recommended-prev.swiper-button-lock,
.category-recommended-products .category-recommended-next.swiper-button-lock {
  display: none !important;
}

.category-recommended-carousel {
  overflow: hidden;
  /* Extend vertically so card shadows (top/bottom) are not clipped */
  padding-top: 4px;
  margin-top: -4px;
  padding-bottom: 12px;
  margin-bottom: -12px;
}

.category-recommended-swiper {
  overflow: visible;
}

.category-recommended-swiper .swiper-wrapper {
  overflow: visible;
  align-items: stretch !important;
}

.category-recommended-swiper .swiper-slide {
  height: auto !important;
  display: flex !important;
  flex-direction: column;
}

.category-recommended-swiper .swiper-slide > div {
  flex: 1;
  display: flex;
  flex-direction: column;
  width: 100%;
}

/* Keep card shadow identical to product list cards */
.category-recommended-swiper [data-product-card] {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

@media (hover: hover) {
  .category-recommended-swiper [data-product-card]:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  }
}

/* Disabled navigation buttons */
.swiper-button-disabled {
  opacity: 0.4;
  cursor: not-allowed;
  pointer-events: none;
}

/* Pre-constrain slide widths AND gaps to match Swiper's final layout before init,
   preventing the "squished tiles" flash caused by the wrapper lacking gap before
   Swiper JS runs. Widths and gaps mirror the breakpoints in initCategoryRecommendedSlider(). */
.category-recommended-swiper:not(.swiper-initialized) .swiper-wrapper {
  gap: 8px;
}
@media (min-width: 640px) {
  .category-recommended-swiper:not(.swiper-initialized) .swiper-wrapper {
    gap: 12px;
  }
}
@media (min-width: 768px) {
  .category-recommended-swiper:not(.swiper-initialized) .swiper-wrapper {
    gap: 16px;
  }
}
.category-recommended-swiper:not(.swiper-initialized) .swiper-slide {
  width: calc(50% - 4px);
  flex-shrink: 0;
}
@media (min-width: 640px) {
  .category-recommended-swiper:not(.swiper-initialized) .swiper-slide {
    width: calc(50% - 6px);
  }
}
@media (min-width: 768px) {
  .category-recommended-swiper:not(.swiper-initialized) .swiper-slide {
    width: calc(33.333% - 10.667px);
  }
}
@media (min-width: 1024px) {
  .category-recommended-swiper:not(.swiper-initialized) .swiper-slide {
    width: calc(25% - 12px);
  }
}
</style>
{% endif %}
