{% if messages %}
  {# Render messages as toasts using JavaScript #}
  <script>
    (function() {
      function showMessages() {
        if (typeof window.showToast === 'function') {
          {% for message in messages %}
            {% if "admin" not in message.tags %}
              window.showToast(`{{ message|safe }}`, "{% if message.level_tag == 'error' %}error{% else %}success{% endif %}");
            {% endif %}
          {% endfor %}
        } else {
          // Retry if showToast not yet loaded
          setTimeout(showMessages, 50);
        }
      }
      // Wait for page to be fully visible before showing toasts
      if (document.readyState === 'complete') {
        setTimeout(showMessages, 100);
      } else {
        window.addEventListener('load', function() {
          setTimeout(showMessages, 100);
        });
      }
    })();
  </script>
{% endif %}
